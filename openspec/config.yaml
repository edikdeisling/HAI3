schema: spec-driven

context: |
  HAI3: AI-optimized UI dev kit (Drafts → Mockups → Production). Monorepo, npm workspaces.
  Stack: React 19, TypeScript strict, Vite 6, Redux Toolkit, Tailwind, shadcn/ui, Radix, Lucide. Build: tsup; lint: ESLint, dependency-cruiser, knip.
  Monorepo Structure: npm workspaces. L1 SDK (@hai3/state, @hai3/api, @hai3/i18n, @hai3/screensets) — zero cross-dependencies, no React, use anywhere. L2 @hai3/framework (plugins). L3 @hai3/react. UI Layer @hai3/uikit, @hai3/studio. Tooling @hai3/cli.
  Architecture Patterns: Four-layer SDK architecture. Plugin-based framework. App depends on L3. L3 depends on L2. L2 depends on L1.
  Event-driven architecture. Cross-domain communication is allowed only via events. Data flow is fixed: Component -> Action -> Event -> Effect -> Slice -> Store.
  Registries (screensets, uikit, theme, api, route, i18n) self-register at import; do not edit registry root files to add items.
  Imports: same package = relative; app cross-branch = @/; cross-package = workspace name (@hai3/…). Forbidden: package internals (@hai3/*/src/*), any, "as unknown as", barrel exports hiding imports, central ID constants (define where used).
  File naming: components/types/interfaces PascalCase; utils/services/constants/configs/slices/effects/actions camelCase.
  Initialization sequence: uikitRegistry → screensetRegistry → themeRegistry → HAI3Provider.
  Build order: SDK → framework → react → UI → CLI (npm run build:packages).
  Never kill Chrome MCP processes (pkill breaks tools). See .ai/MCP_TROUBLESHOOTING.md.

rules:
  proposal:
    - Include impact on layers and registries; call out rollback or risk where relevant.
  specs:
    - Use Given/When/Then for scenarios; use SHALL for normative requirements.
    - Reference existing patterns before inventing new ones
    - Keep scenarios concrete (example config/code) and tie outcomes to screenset/layer behavior.
  design:
    - Align with four-layer SDK and event-driven flow; document event/effect/slice changes and any module augmentation.
